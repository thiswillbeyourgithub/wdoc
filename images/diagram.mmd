flowchart TD
    Task["Task"]
    UserQuery["User Query"]
    Path["Path"]

    Embeddings["Embedding providers<br/>OpenAI/Cohere/HF"]
    VectorStore["VectorStore<br/>(CompressedFaiss/BinaryFaiss)"]

    Embeddings --> VectorStore

    Raphael["Raphael the Rephraser<br/>Query expansion"]
    Sam["Sam the Summarizer<br/>Document summary"]
    Eve["Eve the Evaluator<br/>Document filtering"]
    Anna["Anna the Answerer<br/>Per-doc answers"]
    Carl["Carl the Combiner<br/>Answer combination"]

    Path --> VectorStore
    UserQuery --> Raphael
    Raphael --> Embeddings
    
    VectorStore -->|50 docs| Eve
    
    Eve -->|37 docs| Anna
    
    Anna -->|37 answers| Carl

    Carl --> Carl

    subgraph UserOutput["User Output"]
        Output["General Output"]
        SummaryOutput["wdocSummary object"]
    end
    
    Carl -->|1 answer| Output
    
    Task -->|task=query| Raphael
    Task -->|task=summary| Sam
    Sam --> SummaryOutput
