flowchart TD
    Task["Task"]
    UserQuery["User Query"]
    Path["Path"]

    subgraph AIMLPipeline["AI/ML Pipeline"]
        Embeddings["Embedding providers<br/>OpenAI/Cohere/HF"]
        VectorStore["VectorStore<br/>(CompressedFaiss/BinaryFaiss)"]

        Embeddings --> VectorStore
    end

    subgraph RAGPersonas["RAG Personas"]
        Raphael["Raphael the Rephraser<br/>Query expansion"]
        Sam["Sam the Summarizer<br/>Document summary"]
        Eve["Eve the Evaluator<br/>Document filtering"]
        Anna["Anna the Answerer<br/>Per-doc answers"]
        Carl["Carl the Combiner<br/>Answer combination"]
    end

    Path --> VectorStore
    UserQuery --> Raphael
    Raphael --> Embeddings
    
    VectorStore --> Eve
    VectorStore --> Eve
    VectorStore --> Eve
    VectorStore --> Eve
    VectorStore --> Eve
    VectorStore --> Eve
    VectorStore --> Eve
    VectorStore --> Eve
    VectorStore --> Eve
    VectorStore --> Eve
    
    Eve --> Anna
    Eve --> Anna
    Eve --> Anna
    
    Anna --> Carl
    Anna --> Carl
    Anna --> Carl

    Output["Send output to user"]
    Carl --> Output
    
    Task -->|summary| Sam
    Sam --> Output
